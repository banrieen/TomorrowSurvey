# 武汉长江计算-工业质检平台使用指导和问答（Guide & Solution）

* CustomerPlatform: 工业质检平台 v730
* Date: 2021-0827 + 
* Supportor: Thomas.Bian
* Environment: 武汉长江
* Process: 采集-训练-检测
* Host: ""
* Account: ""
* RemoteConnection: ""
* Notes: 图片没有压缩，都是从本地上传，一张大小约为10M;内存条检测的实际操作： 你拔内存需要时间，按鼠标拍一张，然后插回内存，再拔一根，再按鼠标拍一张；内存条的每一张图间隔好几秒。

## 客户需求(Customer-Requirements):

+ REQ1: 模型训练上云

1. 查看数据集功能中无法删除图片，图片只能添加，不能删除，不便于管理，需要添加删除功能。若不添加，想要一部分标注好的数据集先训练，只能一张一张禁用，留下想用的再发步，1420张禁用耗时8小时。
2. 10.依瞳平台，数据标注后无法修改标注信息
    * ANS 
    可在平台中以该数据集创建一个新的子任务，然后可以做修改操作
1. 依瞳平台，数据集无法删除图片  
    * ANS 
    + 华为同事在本地PC合并数据集
1. 那个数据集没有同步到训练节点，或数据集多了cv_datasets目录的问题你定位了

* ANS ADHub 业务逻辑
压缩包上传是会自动为该数据集创建存储的目录cv_datasets。
平台SCP导入的方式， 需要填入平台路径， 平台路径是需要相对于数据集存储的路径。


## 遗留问题(Legacy-Issues): 

+ 2021-10-08早晨9:17min 设备在国庆节断电后，上电重启后，平台没有自动恢复，master节点docker文件被破坏
+ L-Q1: 标注100张图片数据，在达到60、70张之后会出现卡顿不响应
    - L-Q1-AWS1: 初步定位性能问题，或功能Bug, 没有验证大数据集的情况
2021-09-08 武汉长江培训需求

1. 数据安全；    就离线部署，妥善或严格的账号，认证管理，客户基本接受。
2. 标注自动校验；明确表示暂时不支持。
3. 数据增强；    了解已有需求计划，但是具体场景功能实现待沟通确认。
4. 告警发布，告警去重，一类缺陷只报一次： 不支持，是否计划支持？
5. 多模型检测，场景模板定制： 7-30版本还是固定的4类，是否允许灵活配置？
6. 多工位，工控机推理请求： 功能上满足，但实际推理服务的可靠性，性能带确认。
7. 同一个检测模型适用于不同目标：  明确表示这个需要再训练，但涉及迭代训练，目前不支持！
8. 同一个模型检测不同产品上同一个目标： 待定？
9. 自动标注，功能已有，但实际执行没有效果！
10. 标注审核的备注，在标注员的任务列表看不到, 应该是Bug !

## 现场已解决问题(Resolved-Problem):

+ R-Q1: 训练上云
    - R-Q1-AWS1: 协调更新平台支持该功能，可参考参照: [训练上云(modelarts)适用指导](./工业质检训练上云(modelarts)适用指导.md)。 
        1. huawei modelarts 账号
        2. huawei harbor 的云训练镜像链接
        3. 平台的窗口配置

+ 训练上云任务失败，平台查看log有垃圾信息
+ 训练上云任务在modelarts 执行成功，平台日志接口报408，相关接口：https://support.huaweicloud.com/api-modelarts/modelarts_03_0149.html

+ 0907：yolov4拉取air超时
yolov4的air文件会拉取失败，我对比了下数据： 
Yolov4 训练时常4h+, 日志 500kb ; 模型air文件：220M左右
SSD    训练时常2h+，日志 500kb ；模型air文件：50MB左右


+ 模型评估指标：
    - gt是ground true，是基准样本数，也就是我们的标注数
    - dt是模型预测的样本数
    - tp是正确预测的样本数
    - pre=tp/dt
    - rec=tp/gt
    - pre越高表示检测结果越准确，基本检测出来就是对的，误检少。
    - rec越高表示检测结果越全，漏检越少
